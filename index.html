<html>
  <head>
    <script src="js/lib/markdown.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body>
    <input type="text" id="search" class="search" autocomplete="off" />
    <div class="content" id="content"></div>

    <script>
// Render the loaded content
function renderContent(data){
  // convert markdown to html
  var html = markdown.toHTML(data)
  // render in content area
  document.getElementById('content').innerHTML = html
}

// load the content
function loadContent(hash) {
  // create new request
  var request = new XMLHttpRequest()
  // point to content file
  request.open('GET', 'content/content.txt')
  // handle response...
  request.onreadystatechange = function() {
    if (request.readyState == 4 && request.status == 200) {
      renderContent(request.responseText)
    }
  }
  // send the request
  request.send()
}

// Initialising...
// load content
loadContent()

// assign search element to variable
var searchInput = document.getElementById('search')
// focus search input field
searchInput.focus()

// handle search input usage
searchInput.onkeyup = function(){
  // check not empty...
  if (searchInput.value != '') {
    doSearch(searchInput.value)
  } else {
    clearSearch()
  }
}

function clearSearch(){
  // an object of all content elements
  var elements = document.querySelectorAll('p');
  // cycle through object
  Array.prototype.forEach.call(elements, function(el, i){
    // show all
    el.classList.remove('is-hidden')

    // get content
    text = el.innerHTML

    // remove any inserted markup
    text = text.replace('<mark>', '')
    text = text.replace('</mark>', '')

    // replace content
    el.innerHTML = text
  })
}

function doSearch(term){
  // clear previous search
  clearSearch()

  // an object of all content elements
  var elements = document.querySelectorAll('p');
  // cycle through them
  Array.prototype.forEach.call(elements, function(el, i){
    // get the text as a string
    var text = el.innerHTML

    // search for string:
    // if no match...
    if (text.indexOf(term) < 0) {
      // hide this element
      el.classList.add('is-hidden')
      // remove inserted markup
      text.replace('<mark>', '')
      text.replace('</mark>', '')
    } else {
      // if match...
      // show this
      el.classList.remove('is-hidden')
      // highlight term in result
      text = text.replace(term, '<mark>'+term+'</mark>')
      // replace original string with modified
      el.innerHTML = text
    }
  });
}
    </script>
  </body>
</html>
